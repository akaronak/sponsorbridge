# ═══════════════════════════════════════════════════════
# Eventra Platform — Common Configuration
# Active profile set via SPRING_PROFILES_ACTIVE env var
# ═══════════════════════════════════════════════════════

server.port=${PORT:${SERVER_PORT:8080}}
server.servlet.context-path=/
spring.application.name=${APP_NAME:eventra}

# ─── CORS ────────────────────────────────────────────
# Comma-separated list of allowed origins (no wildcards in production)
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}

# ─── MongoDB Atlas ────────────────────────────────────
# Local dev default; overridden by prod profile / env var
spring.data.mongodb.uri=${MONGODB_URI:mongodb://localhost:27017/eventra}
spring.data.mongodb.auto-index-creation=true
spring.data.mongodb.uuid-representation=standard

# ─── Redis ────────────────────────────────────────────
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=16
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=2
spring.data.redis.lettuce.pool.max-wait=500ms
spring.data.redis.lettuce.shutdown-timeout=200ms

# ─── Caching ─────────────────────────────────────────
spring.cache.type=redis
spring.cache.redis.time-to-live=600000
spring.cache.redis.cache-null-values=false
spring.cache.redis.key-prefix=${APP_NAME:eventra}:cache:

# ─── Rate Limiting ───────────────────────────────────
rate-limit.default.capacity=100
rate-limit.default.refill-tokens=100
rate-limit.default.refill-duration=60
rate-limit.admin.capacity=500
rate-limit.admin.refill-tokens=500
rate-limit.admin.refill-duration=60
rate-limit.anonymous.capacity=30
rate-limit.anonymous.refill-tokens=30
rate-limit.anonymous.refill-duration=60

# ─── JWT ──────────────────────────────────────────────
# REQUIRED: No default — app will fail to start without JWT_SECRET set
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}

# ─── Cloudinary ──────────────────────────────────────
cloudinary.cloud-name=${CLOUDINARY_CLOUD_NAME:}
cloudinary.api-key=${CLOUDINARY_API_KEY:}
cloudinary.api-secret=${CLOUDINARY_API_SECRET:}

# ─── Gemini AI ───────────────────────────────────────
gemini.api.key=${GEMINI_API_KEY:}
gemini.api.url=${GEMINI_API_URL:https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent}
gemini.api.timeout=${GEMINI_API_TIMEOUT:30}

# ─── Razorpay Payment Gateway ───────────────────────
payment.razorpay-key-id=${RAZORPAY_KEY_ID:}
payment.razorpay-key-secret=${RAZORPAY_KEY_SECRET:}
payment.razorpay-webhook-secret=${RAZORPAY_WEBHOOK_SECRET:}

# ─── Escrow & Commission ────────────────────────────
payment.escrow-hold-days=${ESCROW_HOLD_DAYS:7}
payment.dispute-auto-resolve-days=${DISPUTE_AUTO_RESOLVE_DAYS:14}
payment.commission-percent=${COMMISSION_PERCENT:10.0}
payment.min-commission=${MIN_COMMISSION:1.00}
payment.max-payment-amount=${MAX_PAYMENT_AMOUNT:10000000.00}
payment.idempotency-key-ttl-hours=48
payment.webhook-replay-window-seconds=300

# ─── RabbitMQ STOMP Broker Relay ─────────────────────
# When enabled, replaces the in-memory simple broker with an external
# RabbitMQ STOMP relay for horizontal scaling across multiple instances.
stomp.broker.relay.enabled=${STOMP_BROKER_RELAY_ENABLED:false}
stomp.broker.relay.host=${RABBITMQ_HOST:localhost}
stomp.broker.relay.port=${RABBITMQ_STOMP_PORT:61613}
stomp.broker.relay.login=${RABBITMQ_USER:guest}
stomp.broker.relay.passcode=${RABBITMQ_PASS:guest}
stomp.broker.relay.virtual-host=${RABBITMQ_VHOST:/}
stomp.broker.heartbeat.send=${STOMP_HEARTBEAT_SEND:10000}
stomp.broker.heartbeat.receive=${STOMP_HEARTBEAT_RECEIVE:10000}

# ─── Scheduling ─────────────────────────────────────
spring.task.scheduling.pool.size=2
payment.escrow-release-cron=0 0 * * * *
payment.dispute-resolve-cron=0 0 */4 * * *

# ─── Actuator / Observability ────────────────────────
management.endpoints.web.exposure.include=health,info,metrics,prometheus,caches
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.metrics.tags.application=${APP_NAME:eventra}
management.prometheus.metrics.export.enabled=true

# ─── Distributed Tracing (OpenTelemetry → Jaeger) ────
management.tracing.enabled=${TRACING_ENABLED:false}
management.tracing.sampling.probability=${TRACING_SAMPLING:0.1}
management.otlp.tracing.endpoint=${OTLP_TRACING_ENDPOINT:http://localhost:4318/v1/traces}

# ─── Logging (env-driven category levels) ────────────
logging.level.com.eventra.filter=${LOG_LEVEL_AUTH:INFO}
logging.level.com.eventra.service.PaymentService=${LOG_LEVEL_PAYMENTS:INFO}
logging.level.com.eventra.service.MessageService=${LOG_LEVEL_MESSAGING:INFO}
logging.level.com.eventra.service.RateLimitService=${LOG_LEVEL_RATELIMIT:INFO}

# ─── Logging ─────────────────────────────────────────
logging.level.root=INFO
logging.level.com.eventra=DEBUG
logging.level.org.springframework.data.mongodb=INFO
logging.level.org.springframework.cache=DEBUG
logging.level.io.lettuce.core=INFO
logging.level.org.springframework.messaging=INFO
logging.level.org.springframework.web.socket=INFO
