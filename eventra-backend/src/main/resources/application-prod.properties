# ═══════════════════════════════════════════════════════
# Eventra Platform — PRODUCTION Profile
# Activated via: SPRING_PROFILES_ACTIVE=prod
# ═══════════════════════════════════════════════════════

# ─── MongoDB Atlas (TLS/SRV) ─────────────────────────
# Connection string from Atlas dashboard:
#   mongodb+srv://<user>:<pass>@<cluster>.mongodb.net/<db>?retryWrites=true&w=majority
# IMPORTANT: MONGODB_URI must include the database name in the path (e.g., /eventra)
# NOTE: Remove appName from the URI — it's set explicitly below to avoid the
#       "applicationName UTF-8 encoding length <= 128" MongoDB driver error.
spring.data.mongodb.uri=${MONGODB_URI}
spring.data.mongodb.database=${MONGODB_DATABASE:eventra}
spring.data.mongodb.application-name=eventra
spring.data.mongodb.auto-index-creation=false

# ─── Redis (AWS ElastiCache / Azure Cache) ───────────
spring.data.redis.host=${REDIS_HOST}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD}
spring.data.redis.ssl.enabled=${REDIS_SSL:true}
spring.data.redis.lettuce.pool.max-active=32
spring.data.redis.lettuce.pool.max-idle=16
spring.data.redis.lettuce.pool.min-idle=4
spring.data.redis.lettuce.pool.max-wait=1000ms
spring.data.redis.timeout=3000ms

# ─── Security ────────────────────────────────────────
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:43200000}

# ─── Rate Limiting (tighter for production) ──────────
rate-limit.default.capacity=100
rate-limit.default.refill-tokens=100
rate-limit.default.refill-duration=60
rate-limit.admin.capacity=500
rate-limit.admin.refill-tokens=500
rate-limit.admin.refill-duration=60
rate-limit.anonymous.capacity=20
rate-limit.anonymous.refill-tokens=20
rate-limit.anonymous.refill-duration=60

# ─── Actuator (lock down in prod) ────────────────────
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=never
management.endpoint.health.probes.enabled=true

# ─── Logging ─────────────────────────────────────────
logging.level.root=WARN
logging.level.com.eventra=INFO
logging.level.org.springframework.data.mongodb=WARN
logging.level.org.springframework.cache=WARN
logging.level.io.lettuce.core=WARN

# ─── Distributed Tracing (prod — sample 10% for cost control) ──
management.tracing.enabled=${TRACING_ENABLED:true}
management.tracing.sampling.probability=${TRACING_SAMPLING:0.1}
management.otlp.tracing.endpoint=${OTLP_TRACING_ENDPOINT:http://jaeger:4318/v1/traces}

# ─── RabbitMQ STOMP Broker Relay ─────────────────────
# Set STOMP_BROKER_RELAY_ENABLED=true only when RabbitMQ is available.
# On Render (no RabbitMQ), set to false — falls back to in-memory simple broker.
stomp.broker.relay.enabled=${STOMP_BROKER_RELAY_ENABLED:false}
stomp.broker.relay.host=${RABBITMQ_HOST:localhost}
stomp.broker.relay.port=${RABBITMQ_STOMP_PORT:61613}
stomp.broker.relay.login=${RABBITMQ_USER:guest}
stomp.broker.relay.passcode=${RABBITMQ_PASS:guest}
stomp.broker.relay.virtual-host=${RABBITMQ_VHOST:/}
stomp.broker.heartbeat.send=10000
stomp.broker.heartbeat.receive=10000

# ─── Server tuning ──────────────────────────────────
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=20
server.tomcat.accept-count=100
server.tomcat.max-connections=10000
server.compression.enabled=true
server.compression.min-response-size=1024
